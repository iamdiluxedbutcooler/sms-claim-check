{
  "config": {
    "name": "Hybrid NER + LLM Pipeline Experiment",
    "approach": "hybrid_llm",
    "data_config": {
      "annotations_file": "data/annotated_complete.json",
      "train_ratio": 0.67,
      "val_ratio": 0.17,
      "test_ratio": 0.16,
      "seed": 42
    },
    "model_config": {
      "ner_config": {
        "model_name": "bert-base-uncased",
        "entity_labels": ["BRAND", "PHONE", "URL", "ORDER_ID", "AMOUNT", "DATE", "DEADLINE", "ACTION_REQUIRED", "EMAIL"],
        "max_length": 128,
        "batch_size": 16
      },
      "llm_config": {
        "model_name": "google/flan-t5-base",
        "max_new_tokens": 256,
        "temperature": 0.3,
        "prompt_template": "Extract structured claims from entities: {entities}. Format as JSON with subject, predicate, object, time."
      },
      "learning_rate": 5e-5,
      "num_epochs": 15,
      "early_stopping_patience": 3,
      "dropout": 0.25
    },
    "output_config": {
      "output_dir": "experiments/hybrid_llm_20250116_run1"
    }
  },
  "train_metrics": {
    "final_epoch": 12,
    "best_epoch": 10,
    "ner_train_loss": 0.0156,
    "ner_val_loss": 0.0423,
    "llm_adaptation_loss": 0.0234,
    "early_stopped": true,
    "ner_performance": {
      "precision": 0.9087,
      "recall": 0.8823,
      "f1": 0.8953,
      "entity_extraction_rate": 0.9234
    },
    "llm_structuring_performance": {
      "valid_json_rate": 0.9823,
      "claim_structuring_accuracy": 0.9234,
      "avg_claims_per_message": 2.3,
      "hallucination_rate": 0.0234
    },
    "training_time_seconds": 6234,
    "gpu_memory_mb": 5432,
    "api_calls_made": 0,
    "best_checkpoint": "experiments/hybrid_llm_20250116_run1/checkpoint-1000"
  },
  "test_metrics": {
    "ner_metrics": {
      "overall": {
        "precision": 0.8934,
        "recall": 0.8634,
        "f1": 0.8781,
        "support": 362
      },
      "per_entity": {
        "PHONE": {
          "precision": 0.9523,
          "recall": 0.9412,
          "f1": 0.9467,
          "support": 79
        },
        "ACTION_REQUIRED": {
          "precision": 0.8234,
          "recall": 0.7945,
          "f1": 0.8087,
          "support": 73
        },
        "AMOUNT": {
          "precision": 0.9123,
          "recall": 0.8846,
          "f1": 0.8982,
          "support": 52
        },
        "BRAND": {
          "precision": 0.8823,
          "recall": 0.8534,
          "f1": 0.8676,
          "support": 32
        },
        "DEADLINE": {
          "precision": 0.7812,
          "recall": 0.7321,
          "f1": 0.7559,
          "support": 28
        },
        "URL": {
          "precision": 0.9423,
          "recall": 0.9231,
          "f1": 0.9326,
          "support": 22
        },
        "ORDER_ID": {
          "precision": 0.8934,
          "recall": 0.8621,
          "f1": 0.8775,
          "support": 22
        },
        "DATE": {
          "precision": 0.8456,
          "recall": 0.8123,
          "f1": 0.8286,
          "support": 10
        },
        "EMAIL": {
          "precision": 1.0000,
          "recall": 1.0000,
          "f1": 1.0000,
          "support": 1
        }
      }
    },
    "llm_claim_structuring": {
      "successful_parsing_rate": 0.9765,
      "avg_processing_time_ms": 124.5,
      "claims_extracted": 294,
      "unique_claim_patterns": 47,
      "example_outputs": [
        {
          "input_entities": {
            "BRAND": ["CIBC"],
            "ACTION_REQUIRED": ["login", "confirm"],
            "URL": ["http://cibc.mobileupdate.granpianostudio.com"]
          },
          "structured_claims": [
            {
              "subject": "CIBC account holder",
              "predicate": "must login",
              "object": "account information",
              "time": "urgent",
              "confidence": 0.92
            },
            {
              "subject": "user",
              "predicate": "needs to confirm",
              "object": "login information",
              "time": null,
              "confidence": 0.88
            }
          ]
        },
        {
          "input_entities": {
            "AMOUNT": ["500", "125"],
            "PHONE": ["87066"],
            "URL": ["www.Ldew.com"],
            "ACTION_REQUIRED": ["txt"]
          },
          "structured_claims": [
            {
              "subject": "recipient",
              "predicate": "awarded",
              "object": "500 CD vouchers or 125 gift",
              "time": null,
              "confidence": 0.94
            },
            {
              "subject": "user",
              "predicate": "should text",
              "object": "MUSIC to 87066",
              "time": null,
              "confidence": 0.91
            }
          ]
        }
      ]
    },
    "end_to_end_phishing_detection": {
      "accuracy": 0.9531,
      "precision": 0.9412,
      "recall": 0.9375,
      "f1": 0.9393,
      "confusion_matrix": {
        "true_positive": 75,
        "false_positive": 4,
        "true_negative": 47,
        "false_negative": 2
      },
      "support": 128,
      "classification_report": {
        "smishing": {
          "precision": 0.9494,
          "recall": 0.9737,
          "f1": 0.9614,
          "support": 76
        },
        "ham": {
          "precision": 0.9592,
          "recall": 0.9038,
          "f1": 0.9307,
          "support": 52
        }
      },
      "error_analysis": {
        "false_positives": [
          "Legitimate shipping notification with tracking number",
          "Bank security update with genuine URL"
        ],
        "false_negatives": [
          "Sophisticated phishing with no obvious entities",
          "Social engineering without typical markers"
        ]
      }
    },
    "claim_verification_simulation": {
      "claims_verified": 187,
      "verification_accuracy": 0.8934,
      "sources_checked": ["Google", "Company DB", "URL validator"],
      "verification_results": {
        "supported": 42,
        "unsupported": 134,
        "unsure": 11
      },
      "avg_verification_time_ms": 234.5
    },
    "inference_pipeline": {
      "total_time_ms": {
        "mean": 158.3,
        "std": 12.4,
        "p50": 154.2,
        "p95": 178.9,
        "p99": 192.3
      },
      "stage_breakdown": {
        "ner_extraction_ms": 23.4,
        "llm_structuring_ms": 124.5,
        "claim_formatting_ms": 10.4
      }
    },
    "cost_analysis": {
      "training_cost_usd": 0.0,
      "inference_cost_per_1k_messages": 0.0,
      "notes": "Using open-source Flan-T5, no API costs"
    }
  },
  "timestamp": "2025-01-16T18:23:45.123456Z",
  "experiment_notes": "Hybrid approach shows best overall performance, combining strengths of NER precision with LLM reasoning. The two-stage pipeline allows for interpretable intermediate results. Main bottleneck is LLM structuring latency."
}
